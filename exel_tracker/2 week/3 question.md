# Что такое proxy_set_header, зачем нужен X-Real-IP?

`proxy_set_header` — это директива в конфигурации Nginx, которая используется для установки значений HTTP заголовков, когда запрос передается на проксируемый сервер (например, через обратный прокси). Это необходимо для того, чтобы сохранить правильные данные о запросах, такие как исходный IP-адрес клиента или информация о том, как запрос был изначально отправлен.

# Что делает `proxy_set_header`?
Она используется для настройки заголовков, которые проксируемый сервер должен увидеть, чтобы правильно обработать запрос. Например, если Nginx действует как обратный прокси, он может изменить или добавить заголовки, чтобы передать информацию о клиенте или исходном запросе к внутреннему серверу.

# Пример:

```
location / {
    proxy_pass http://backend;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

# Зачем нужен заголовок `X-Real-IP`?
Заголовок `X-Real-IP` передает реальный IP-адрес клиента, который делает запрос. Это важно, потому что когда используется проксирование (например, через Nginx), реальный IP-адрес клиента может быть скрыт, и вместо этого сервер может видеть только IP-адрес прокси-сервера.

Заголовок `X-Real-IP` позволяет проксируемому серверу (или приложению) узнать истинный IP-адрес клиента, что может быть полезно для:

1. Логирования.

2. Применения фильтрации по IP.

3. Определения местоположения пользователя.

4. Проведения анализа или статистики.

Без `X-Real-IP` проксируемые серверы будут видеть только IP-адрес прокси-сервера, что делает идентификацию источника запроса затруднительной.

# Пример:
Если пользователь с IP-адресом `192.168.1.100` отправляет запрос через Nginx, и Nginx проксирует этот запрос на внутренний сервер, то на внутреннем сервере можно настроить получение заголовка `X-Real-IP`, чтобы узнать реальный IP-адрес пользователя:

````
proxy_set_header X-Real-IP $remote_addr;
````

На сервере можно будет получить `X-Real-IP: 192.168.1.100`.

Это особенно полезно для приложений, которые должны работать с реальными IP-адресами пользователей, например, для безопасности или аналитики.

